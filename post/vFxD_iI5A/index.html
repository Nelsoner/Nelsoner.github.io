<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>前端传来的数据校验 | Gridea</title>
<meta name="description" content="温故而知新" />
<link rel="shortcut icon" href="https://Nelsoner.github.io/favicon.ico?v=1574218922170">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://Nelsoner.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://Nelsoner.github.io">
  <img class="avatar" src="https://Nelsoner.github.io/images/avatar.png?v=1574218922170" alt="">
  </a>
  <h1 class="site-title">
    Gridea
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
      
        <a href="/post/you-lian/" class="menu">
          友链
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              前端传来的数据校验
            </h2>
            <div class="post-info">
              <span>
                2019-11-20 10:30:51
              </span>
              <span>
                5 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p><strong>最近写了好多的非空校验，写得想吐了，所以千方百计想办法偷懒</strong></p>
<!-- more -->
<h2 id="一-使用annotaion-jsr-303标准的校验">一、使用Annotaion JSR-303标准的校验</h2>
<p><strong>hibernate-validator中部分注解进行描述</strong></p>
<table>
<thead>
<tr>
<th>@AssertTrue</th>
<th>用于boolean字段，该字段只能为true</th>
</tr>
</thead>
<tbody>
<tr>
<td>@AssertFalse</td>
<td>该字段的值只能为false</td>
</tr>
<tr>
<td>@CreditCardNumber</td>
<td>对信用卡号进行一个大致的验证</td>
</tr>
<tr>
<td>@DecimalMax</td>
<td>只能小于或等于该值</td>
</tr>
<tr>
<td>@DecimalMin</td>
<td>只能大于或等于该值</td>
</tr>
<tr>
<td>@Digits(integer=,fraction=)</td>
<td>检查是否是一种数字的整数、分数,小数位数的数字</td>
</tr>
<tr>
<td>@Email</td>
<td>检查是否是一个有效的email地址</td>
</tr>
<tr>
<td>@Future</td>
<td>检查该字段的日期是否是属于将来的日期</td>
</tr>
<tr>
<td>@Length(min=,max=)</td>
<td>检查所属的字段的长度是否在min和max之间,只能用于字符串</td>
</tr>
<tr>
<td>@Max</td>
<td>该字段的值只能小于或等于该值</td>
</tr>
<tr>
<td>@Min</td>
<td>该字段的值只能大于或等于该值</td>
</tr>
<tr>
<td>@NotNull</td>
<td>不能为null</td>
</tr>
<tr>
<td>@NotBlank</td>
<td>不能为空，检查时会将空格忽略</td>
</tr>
<tr>
<td>@NotEmpty</td>
<td>不能为空，这里的空是指空字符串</td>
</tr>
<tr>
<td>@Null</td>
<td>检查该字段为空</td>
</tr>
<tr>
<td>@Past</td>
<td>检查该字段的日期是在过去</td>
</tr>
<tr>
<td>@Pattern(regex=,flag=)</td>
<td>被注释的元素必须符合指定的正则表达式</td>
</tr>
<tr>
<td>@Range(min=,max=,message=)</td>
<td>被注释的元素必须在合适的范围内</td>
</tr>
<tr>
<td>@Size(min=, max=)</td>
<td>检查该字段的size是否在min和max之间，可以是字符串、数组、集合、Map等</td>
</tr>
<tr>
<td>@URL(protocol=,host,port)</td>
<td>检查是否是一个有效的URL，如果提供了protocol，host等，则该URL还需满足提供的条件</td>
</tr>
<tr>
<td>@Valid</td>
<td>该注解主要用于字段为一个包含其他对象的集合或map或数组的字段，或该字段直接为一个其他对象的引用，这样在检查当前对象的同时也会检查该字段所引用的对象</td>
</tr>
</tbody>
</table>
<p><em>但是仅仅是这些校验显然是不够的</em></p>
<h2 id="二-自定义注解实现校验">二、自定义注解实现校验</h2>
<p>User类</p>
<pre><code class="language-java">@Data
public class User{

    //hibernate-validator校验
    @NotEmpty(message = &quot;用户名不能为空&quot;)
    private String username;

    //自定义验证注解
    @MyPasswordConstraint(message = &quot;密码格式错误&quot;)
    private String password;

    private String nickname;

}
</code></pre>
<p>MyPasswordConstraint自定义注解</p>
<pre><code class="language-java">@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER })
@Retention(RUNTIME)
@Documented
@Constraint(validatedBy = {MyPasswordConstraint.PasswordValidatorString.class, MyPasswordConstraint.PasswordValidatorLong.class}) //这里可以写多个
public @interface MyPasswordConstraint {
    String message() default &quot;&quot;;

    Class&lt;?&gt;[] groups() default {};

    Class&lt;? extends Payload&gt;[] payload() default {};

    //为了代码好看，就写个内部类
    class PasswordValidatorString implements ConstraintValidator&lt;MyPasswordConstraint, String&gt; {

        //由于实现了ConstraintValidator接口，
        // 它默认被spring管理成bean,
        // 可以用@Autowiredu或者@Resources注入别的服务，
        // 而且不用在类上面用@Compent注解成spring的bean

        //初始化
        @Override
        public void initialize(MyPasswordConstraint constraintAnnotation) {

        }

        //校验逻辑
        @Override
        public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) {
            return false;
        }
    }

    class PasswordValidatorLong implements ConstraintValidator&lt;MyPasswordConstraint, Long&gt; {

        @Override
        public void initialize(MyPasswordConstraint constraintAnnotation) {

        }

        @Override
        public boolean isValid(Long aLong, ConstraintValidatorContext constraintValidatorContext) {
            return false;
        }

    }
}
</code></pre>
<p>UserController</p>
<pre><code class="language-java">@RestController
public class UserController {

    @RequestMapping(value = &quot;/user/add&quot;, method = RequestMethod.POST)
    public String addUser(@Valid @RequestBody User user, BindingResult bindingResult){
        if (bindingResult.hasErrors()) {
            List&lt;ObjectError&gt; allErrors = bindingResult.getAllErrors();
            FieldError error = (FieldError) allErrors.get(0);
            String message = error.getField() + &quot; &quot; + error.getDefaultMessage();
            return message;
        }
        System.out.println(user.getUsername());
        return user.getUsername();
    }
}
</code></pre>
<blockquote>
<p>这里必须要说一哈，(@Valid @RequestBody User user, BindingResult bindingResult)参数列表中，如果bindingResult不加，数据校验不通过的话，不会进入Controller；所以这里我们加上这个参数，可以根据校验的结果封装成统一的、我们希望的格式的结果返回给亲请求端</p>
</blockquote>
<h2 id="三-基于validator接口的校验">三、基于Validator接口的校验</h2>
<p>UserTWO类</p>
<pre><code class="language-java">@Data
public class UserTWO {

    private String username;

    private String password;

    private String nickname;

}
</code></pre>
<p>UserValidator类</p>
<pre><code class="language-java">public class UserValidator implements Validator {
    @Override
    public boolean supports(Class&lt;?&gt; aClass) {
        //判断是否是要校验的类,这里是User
        return UserTWO.class.equals(aClass);
    }

    @Override
    public void validate(Object o, Errors errors) {
        UserTWO u = (UserTWO) o;
        if (null == u.getPassword() || &quot;&quot;.equals(u.getPassword())) {
            //field, 校验信息
            //errors.rejectValue(&quot;password&quot;, &quot;密码不能为空&quot;);
            errors.reject(&quot;password&quot;, &quot;密码不能为空&quot;);
        }
        //这里可以对User的域，挨个校验

    }
}
</code></pre>
<p>UserTWOController类</p>
<pre><code class="language-java">@RestController
public class UserTWOController {

    //在Controller类中通过@InitBinder标记的方法只有在请求当前Controller的时候才会被执行
    //注册校验器
    @InitBinder
    public void initBainder(DataBinder binder){
        binder.replaceValidators(new UserValidator());
    }
    
    @RequestMapping(value = &quot;/userTwo/add&quot;, method = RequestMethod.POST)
    public String addUser(@Valid @RequestBody UserTWO user, BindingResult bindingResult){
        if (bindingResult.hasErrors()) {
            List&lt;ObjectError&gt; allErrors = bindingResult.getAllErrors();
            String message =  allErrors.get(0).getCode() + &quot; &quot; + allErrors.get(0).getDefaultMessage();
            return message;
        }
        System.out.println(user.getUsername());
        return user.getUsername();
    }
}

</code></pre>
<pre><code>基于Validator接口的校验，比较nice，直接一个实体类的校验全做了
</code></pre>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E4%BD%BF%E7%94%A8annotaion-jsr-303%E6%A0%87%E5%87%86%E7%9A%84%E6%A0%A1%E9%AA%8C">一、使用Annotaion JSR-303标准的校验</a></li>
<li><a href="#%E4%BA%8C-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%A0%A1%E9%AA%8C">二、自定义注解实现校验</a></li>
<li><a href="#%E4%B8%89-%E5%9F%BA%E4%BA%8Evalidator%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%A0%A1%E9%AA%8C">三、基于Validator接口的校验</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://Nelsoner.github.io/post/hello-gridea">
              <h3 class="post-title">
                Hello Gridea
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
<script>
 
!function(){
 
 function n(n,e,t){
 
 return n.getAttribute(e)||t
 
 }
 
 function e(n){
 
 return document.getElementsByTagName(n)
 
 }
 
 function t(){
 
 var t=e("script"),o=t.length,i=t[o-1];
 
 return{
 
 l:o,z:n(i,"zIndex",-1),o:n(i,"opacity",.5),c:n(i,"color","0,0,0"),n:n(i,"count",99)
 
 }
 
 }
 
 function o(){
 
 a=m.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,
 
 c=m.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight
 
 }
 
 function i(){
 
 r.clearRect(0,0,a,c);
 
 var n,e,t,o,m,l;
 
 s.forEach(function(i,x){
 
 for(i.x+=i.xa,i.y+=i.ya,i.xa*=i.x>a||i.x<0?-1:1,i.ya*=i.y>c||i.y<0?-1:1,r.fillRect(i.x-.5,i.y-.5,1,1),e=x+1;e<u.length;e++)n=u[e],
 
 null!==n.x&&null!==n.y&&(o=i.x-n.x,m=i.y-n.y,
 
 l=o*o+m*m,l<n.max&&(n===y&&l>=n.max/2&&(i.x-=.03*o,i.y-=.03*m),
 
 t=(n.max-l)/n.max,r.beginPath(),r.lineWidth=t/2,r.strokeStyle="rgba("+d.c+","+(t+.2)+")",r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.stroke()))
 
 }),

 x(i)
 
 }
 
 var a,c,u,m=document.createElement("canvas"),
 
 d=t(),l="c_n"+d.l,r=m.getContext("2d"),
x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
 
 function(n){

 window.setTimeout(n,1e3/45)
 
 },
 
 w=Math.random,y={x:null,y:null,max:2e4};m.id=l,m.style.cssText="position:fixed;top:0;left:0;z-index:"+d.z+";opacity:"+d.o,e("body")[0].appendChild(m),o(),window.onresize=o,
 
 window.onmousemove=function(n){
 
 n=n||window.event,y.x=n.clientX,y.y=n.clientY
 
 },
 
 window.onmouseout=function(){
 
 y.x=null,y.y=null
 
 };
 
 for(var s=[],f=0;d.n>f;f++){
 
 var h=w()*a,g=w()*c,v=2*w()-1,p=2*w()-1;s.push({x:h,y:g,xa:v,ya:p,max:6e3})
 
 }
 
 u=s.concat([y]),
 
 setTimeout(function(){i()},100)
 
 }();
 </script> | 
  <a class="rss" href="https://Nelsoner.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
